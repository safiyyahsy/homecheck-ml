{% extends "base.html" %}

{% block title %}Professional Contact Template - CottageCheck{% endblock %}

{% block body_class %}email-template-page{% endblock %}

{% block extra_css %}
    <style>
        .email-container {
            max-width: 800px;
            margin: 0 auto;
            padding: var(--space-xxl) var(--space-lg);
        }

        .email-header {
            text-align: center;
            margin-bottom: var(--space-xxl);
        }

        .template-section {
            background: var(--cottage-white);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            margin-bottom: var(--space-xl);
            box-shadow: var(--shadow-md);
        }

        .email-preview {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: var(--radius-sm);
            padding: var(--space-lg);
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: var(--space-lg) 0;
            white-space: pre-line;
        }

        .form-group {
            margin-bottom: var(--space-md);
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: var(--space-xs);
            color: var(--text-on-light);
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: var(--space-sm);
            border: 2px solid rgba(74, 144, 164, 0.2);
            border-radius: var(--radius-sm);
            font-family: var(--font-secondary);
            transition: border-color var(--transition-normal);
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--cottage-blue);
        }

        .copy-button {
            background: var(--cottage-blue);
            color: white;
            border: none;
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 600;
            transition: all var(--transition-normal);
        }

        .copy-button:hover {
            background: var(--cottage-steel);
            transform: translateY(-2px);
        }

        .copy-button.copied {
            background: #28a745;
        }

        .action-buttons {
            display: flex;
            gap: var(--space-md);
            justify-content: center;
            flex-wrap: wrap;
            margin-top: var(--space-xl);
        }

        @media (max-width: 768px) {
            .email-container {
                padding: var(--space-xl) var(--space-md);
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
{% endblock %}

{% block content %}
    <div class="email-container">
        <div class="email-header">
            <h1 data-aos="fade-up">üìß Professional Contact Template</h1>
            <p data-aos="fade-up" data-aos-delay="200">
                Generate a professional email template to send to contractors and specialists
            </p>
        </div>

        <!-- Contact Information Form -->
        <div class="template-section" data-aos="fade-up" data-aos-delay="300">
            <h3>üìù Your Information</h3>
            <form id="emailForm">
                <div class="form-group">
                    <label for="homeowner_name">Your Name:</label>
                    <input type="text" id="homeowner_name" placeholder="Enter your full name" required>
                </div>
                
                <div class="form-group">
                    <label for="home_address">Home Address:</label>
                    <input type="text" id="home_address" placeholder="Enter home address" required>
                </div>
                
                <div class="form-group">
                    <label for="phone">Phone Number:</label>
                    <input type="tel" id="phone" placeholder="Enter your phone number">
                </div>
                
                <div class="form-group">
                    <label for="email">Email Address:</label>
                    <input type="email" id="email" placeholder="Enter your email address">
                </div>
                
                <div class="form-group">
                    <label for="preferred_time">Preferred Contact Time:</label>
                    <input type="text" id="preferred_time" placeholder="e.g., Weekdays 9 AM - 5 PM">
                </div>
                
                <div class="form-group">
                    <label for="additional_notes">Additional Notes:</label>
                    <textarea id="additional_notes" rows="3" placeholder="Any additional information or specific requirements"></textarea>
                </div>
            </form>
        </div>

        <!-- Email Template Preview -->
        <div class="template-section" data-aos="fade-up" data-aos-delay="400">
            <h3>üìÑ Email Template Preview</h3>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-md);">
                <span><strong>Subject:</strong> <span id="email_subject">Cottage Inspection - {{ issue_type }} Repair Request</span></span>
                <button class="copy-button" onclick="copyToClipboard('email_content')">üìã Copy Email</button>
            </div>
            
            <div class="email-preview" id="email_content">
<strong>Subject:</strong> Home Inspection - {{ issue_type }} Repair Request

Dear Professional,

I hope this email finds you well. I am reaching out regarding repair work needed at my home property.

<strong>INSPECTION DETAILS:</strong>
‚Ä¢ Issue Detected: {{ issue_type }}
‚Ä¢ Detection Method: AI-powered home inspection
‚Ä¢ Inspection Date: {{ inspection_date if inspection_date else 'Recent' }}

<strong>PROPERTY INFORMATION:</strong>
‚Ä¢ Property Owner: [Your Name]
‚Ä¢ Home Address: [Home Address]
‚Ä¢ Property Type: Residential home

<strong>ISSUE DESCRIPTION:</strong>
Our AI inspection system has detected {{ issue_type.lower() }} that requires professional attention. {% if issue_type == 'Major Crack' %}This appears to be a structural issue that needs immediate assessment by a qualified structural engineer.{% elif issue_type == 'Minor Crack' %}While this may be repairable, we would like professional evaluation to ensure proper treatment.{% elif issue_type == 'Peeling' %}The paint and surface deterioration affects both protection and aesthetics of our home.{% elif issue_type == 'Algae' %}There are moisture and algae issues that need professional cleaning and prevention strategies.{% elif issue_type == 'Spalling' %}The concrete/masonry deterioration requires professional repair to prevent further damage.{% elif issue_type == 'Stain' %}Surface staining issues need professional assessment and treatment.{% endif %}

<strong>WHAT WE'RE LOOKING FOR:</strong>
‚Ä¢ Professional assessment of the detected issue
‚Ä¢ Detailed quote for repair work
‚Ä¢ Timeline for completion
‚Ä¢ Warranty information on work performed
‚Ä¢ References from similar residential projects

<strong>CONTACT INFORMATION:</strong>
‚Ä¢ Phone: [Your Phone]
‚Ä¢ Email: [Your Email]
‚Ä¢ Best time to contact: [Preferred Time]

<strong>ADDITIONAL NOTES:</strong>
[Additional Notes]

We appreciate your time and look forward to hearing from you. Please let us know if you need any additional information or would like to schedule a site visit.

Thank you for your consideration.

Best regards,
[Your Name]

---
This inquiry was generated through HomeCheck AI Inspection System
            </div>
        </div>

        <!-- Professional Directory (Optional) -->
        <div class="template-section" data-aos="fade-up" data-aos-delay="500">
            <h3>üîç Finding the Right Professional</h3>
            <p><strong>For {{ issue_type }}:</strong></p>
            
            {% if issue_type == 'Major Crack' %}
                <ul>
                    <li><strong>Structural Engineer:</strong> First priority for assessment</li>
                    <li><strong>General Contractor:</strong> For repair implementation</li>
                    <li><strong>Foundation Specialist:</strong> If foundation-related</li>
                </ul>
                <p><strong>Questions to Ask:</strong></p>
                <ul>
                    <li>Are you licensed as a structural engineer?</li>
                    <li>Do you have experience with residential structures?</li>
                    <li>Can you provide a structural assessment report?</li>
                    <li>What building permits will be required?</li>
                </ul>
            {% elif issue_type == 'Minor Crack' %}
                <ul>
                    <li><strong>General Contractor:</strong> For evaluation and repair</li>
                    <li><strong>Handyman:</strong> For simple crack filling</li>
                    <li><strong>Painter:</strong> For finishing work</li>
                </ul>
                <p><strong>Questions to Ask:</strong></p>
                <ul>
                    <li>What type of crack filler do you recommend?</li>
                    <li>How do you ensure the crack won't return?</li>
                    <li>What warranty do you provide on crack repairs?</li>
                </ul>
            {% elif issue_type == 'Peeling' %}
                <ul>
                    <li><strong>House Painter:</strong> Specialized in exterior work</li>
                    <li><strong>General Contractor:</strong> For extensive surface prep</li>
                    <li><strong>Restoration Specialist:</strong> For historic homes</li>
                </ul>
                <p><strong>Questions to Ask:</strong></p>
                <ul>
                    <li>Do you include surface preparation in your quote?</li>
                    <li>What paint systems do you recommend for homes?</li>
                    <li>How do you handle lead paint safely?</li>
                </ul>
            {% elif issue_type == 'Algae' %}
                <ul>
                    <li><strong>Pressure Washing Service:</strong> For cleaning</li>
                    <li><strong>Landscaper:</strong> For drainage improvements</li>
                    <li><strong>General Contractor:</strong> For structural modifications</li>
                </ul>
                <p><strong>Questions to Ask:</strong></p>
                <ul>
                    <li>What cleaning methods do you use for algae?</li>
                    <li>How do you prevent algae from returning?</li>
                    <li>Can you improve drainage around the home?</li>
                </ul>
            {% elif issue_type == 'Spalling' %}
                <ul>
                    <li><strong>Mason:</strong> For concrete/brick repair</li>
                    <li><strong>Concrete Contractor:</strong> For extensive damage</li>
                    <li><strong>General Contractor:</strong> For comprehensive repairs</li>
                </ul>
                <p><strong>Questions to Ask:</strong></p>
                <ul>
                    <li>What repair method do you recommend?</li>
                    <li>How do you match existing materials?</li>
                    <li>What caused the spalling and how do you prevent it?</li>
                </ul>
            {% elif issue_type == 'Stain' %}
                <ul>
                    <li><strong>Cleaning Service:</strong> For stain removal</li>
                    <li><strong>Restoration Specialist:</strong> For stubborn stains</li>
                    <li><strong>Painter:</strong> If repainting is needed</li>
                </ul>
                <p><strong>Questions to Ask:</strong></p>
                <ul>
                    <li>What caused the staining?</li>
                    <li>Can the stain be completely removed?</li>
                    <li>What prevents stains from recurring?</li>
                </ul>
            {% endif %}
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="cta-button primary" onclick="updateEmailTemplate()">
                üîÑ Update Template
            </button>
            <button class="cta-button secondary" onclick="copyToClipboard('email_content')">
                üìã Copy to Clipboard
            </button>
            <a href="{{ url_for('detailed_report') }}" class="cta-button secondary">
                üìã Back to Report
            </a>
            <a href="{{ url_for('inspection') }}" class="cta-button secondary">
                üîÑ New Inspection
            </a>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
    <script>
        // Update email template with form data
        function updateEmailTemplate() {
            const name = document.getElementById('homeowner_name').value || '[Your Name]';
            const address = document.getElementById('home_address').value || '[Home Address]';
            const phone = document.getElementById('phone').value || '[Your Phone]';
            const email = document.getElementById('email').value || '[Your Email]';
            const preferredTime = document.getElementById('preferred_time').value || '[Preferred Time]';
            const additionalNotes = document.getElementById('additional_notes').value || '[Additional Notes]';
            
            let emailContent = document.getElementById('email_content').textContent;
            
            // Replace placeholders
            emailContent = emailContent.replace(/\[Your Name\]/g, name);
            emailContent = emailContent.replace(/\[Home Address\]/g, address);
            emailContent = emailContent.replace(/\[Your Phone\]/g, phone);
            emailContent = emailContent.replace(/\[Your Email\]/g, email);
            emailContent = emailContent.replace(/\[Preferred Time\]/g, preferredTime);
            emailContent = emailContent.replace(/\[Additional Notes\]/g, additionalNotes);
            
            document.getElementById('email_content').textContent = emailContent;
            
            // Show success message
            showNotification('‚úÖ Email template updated with your information', 'success');
        }

        // Copy content to clipboard
        async function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            
            try {
                await navigator.clipboard.writeText(text);
                
                // Update button temporarily
                const button = event.target;
                const originalText = button.textContent;
                button.textContent = '‚úÖ Copied!';
                button.classList.add('copied');
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
                
                showNotification('üìã Email template copied to clipboard', 'success');
                
            } catch (err) {
                console.error('Copy failed:', err);
                
                // Fallback: select text
                const range = document.createRange();
                range.selectNode(element);
                window.getSelection().removeAllRanges();
                window.getSelection().addRange(range);
                
                showNotification('üìã Text selected - please copy manually (Ctrl+C)', 'info');
            }
        }

        // Auto-update template when form fields change
        function setupAutoUpdate() {
            const formElements = document.querySelectorAll('#emailForm input, #emailForm textarea');
            
            formElements.forEach(element => {
                element.addEventListener('input', function() {
                    // Debounce the update
                    clearTimeout(this.updateTimeout);
                    this.updateTimeout = setTimeout(updateEmailTemplate, 500);
                });
            });
        }

        // Show notification (using the function from main.js)
        function showNotification(message, type = 'info') {
            if (window.CottageCheck && window.CottageCheck.showNotification) {
                window.CottageCheck.showNotification(message, type);
            } else {
                alert(message); // Fallback
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìß Email template page initialized');
            setupAutoUpdate();
            
            // Set default values if available
            const urlParams = new URLSearchParams(window.location.search);
            const confidence = urlParams.get('confidence');
            
            if (confidence) {
                console.log('üéØ Confidence level:', confidence + '%');
            }
        });
    </script>
{% endblock %}